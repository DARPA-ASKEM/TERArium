<html>
	<head>
		<title>Test Client App</title>
		
		<script>
			let accessToken;
			let accessTokenExpires;

			// get accessToken
			const getAccessToken = () => {
				const client = new XMLHttpRequest();
				client.open('GET', '/silent-check-sso.html', true);
				client.send();

				client.onreadystatechange = () => {
					if (client.readyState === client.HEADERS_RECEIVED) {
						accessToken = client.getResponseHeader('OIDC_access_token');
					}
				}
			}
			// TODO: fetch new accessToken when it expires

			const callAPI = (url, id) => {
				const span = document.getElementById(id);
				span.setHTML('...fetching...');

				const client = new XMLHttpRequest();
				client.open('GET', url, true);
				client.setRequestHeader('Authorization', `Bearer ${accessToken}`);
				client.send();

				client.onreadystatechange = () => {
					if (client.readyState === client.DONE) {
						span.setHTML(`STATUS:${client.status} Response: ${client.responseText}`);
					}
				}
			}

			getAccessToken();
		</script>
	</head>
	<body>
		<h1>Test Client App</h1>
		<p><a href="/logout">logout</a></p>

		<h2>User rights required</h2>
		<p><a href="#" onclick="callAPI('/api/user/me', 'user-me'); return false;">/api/user</a> endpoint <span id="user-me"></span></p>

		<h2>Admin right required</h2>
		<p><a href="#" onclick="callAPI('/api/admin', 'admin'); return false;">/api/admin</a> endpoint <span id="admin"></span></p>
	</body>
</html>
